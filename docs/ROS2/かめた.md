## 目次
[[#Turtlesimシミュレータ]]
[[#Turtlesimの起動]]
[[#キーボードでかめたを動かす]]
[[#亀でros2のノードを学ぶ]]
[[#ノードの起動]]
[[#ノードのリマッピング]]
[[#トピックとメッセージを学ぶ]]
[[#サービス]]
[[#アクション]]

## Turtlesimシミュレータ
- rosの公式チュートリアルに用意されている2次元空間で亀が動くシミュレータ

## Turtlesimの起動
~~~bash
ros2 run turtlesim turtlesim_node
~~~

## キーボードでかめたを動かす
~~~bash
ros2 run turtlesim turtle_teleop_key
~~~


## 亀でros2のノードを学ぶ
- ノードはモータを動かしたり、画像をカメラから入力して処理したりという機能を担ってる
- 各ノードはトピック、サービス、アクション、パラメータを利用して他のノードとデータを送受信する
- ros2は一つの実行ファイルに1つ以上のノードを含めることが可能になった

## ノードの起動
- ros2ではnodeの起動にros2 runコマンドを使う
- ros2 run コマンドはros2 run <パッケージ名(ex turtlesim)> <実行可能なファイル名(ex turtlesim_node)>のようにパッケージ名と実行可能なファイル名をオプションとして実行する
~~~bash
ros2 run turtlesim turtlesim_node
~~~

## ノードのリマッピング
- ノードのリマッピング(リネームともいう)機能を使うことでノード名、トピック名、サービス名などのデフォルトのノードプロパティを任意の値に再設定できる
- turtlesimシミュレータを2つ起動してみる
1. 
~~~bash
ros2 run tultlesim turtlesim_node
~~~
2. 上と同じ
~~~bash
ros2 run tultlesim turtlesim_node
~~~
- 色違いが出る
3. 2つ目のノードを停止(ctrl + c)
4. turtlesimをremapオプションで実行
~~~bash
ros2 run tultlesim turtlesim_node --ros-args --remap __node:=my_turtle
~~~

5. ノードを確認
~~~bash
ros2 node list
~~~
~~~txt
/my_turtle
/turtlesim
~~~
- my_turtleが起動しているのがわかる

## トピックとメッセージを学ぶ
1. 
- ノードとトピックの関係をグラフィカルに可視化するツール
~~~bash
rqt_graph
~~~
2. 
- トピックのタイプとトピック名の表示
~~~bash
ros2 topic list -t 
~~~
~~~txt
	topic name     topic type
(ex) /rosout [rcl_interfaes/msg/Log]
~~~
- トピックには名前とタイプがある
- 特にタイプはノードがトピック間を伝搬する時に同じ情報についてやり取りしていることをノードが認識するためのもの

3. トピックの情報取得
- それぞれのトピックの詳細な情報を取得するにはros2 topic info ＜topic name＞のコマンドを使う
~~~bash
ros2 topic info /turtle1/cmd_vel
~~~
~~~txt
Type: geometry_msgs/msg/Twist
Publisher count: 1
Subscription count: 2
~~~
- これは亀を動かす速度を指定するトピックの詳細を取得している様子

4. トピックから配信されているデータの表示
- トピックから配信されているデータを購読するには、ros2 topic echo ＜topic name＞のコマンドを使う
~~~bash
ros2 topic echo 
~~~
- ここでキーボードを使って亀を動かすと以下のように表示される
~~~txt
ex)
liner: 
	x: 2.0
	y: 0.0
	z: 0.0
angler:
	x: 0.0
	y: 0.0
	z: 0.0
---
~~~

5. メッセージ情報の表示
- rosのノードはメッセージを利用してトピック間のデータ交換を実現している
- 配信者と購読者と呼ばれるメッセージの送り手と受け手はどちらも同じタイプのメッセージを利用する必要がある
- ros2 topic list -t で書くトピックが送信できるメッセージのタイプがわかるよ
~~~bash
ros2 topic list -t 
~~~
~~~txt
	topic name     topic type
(ex) /turtle1/cmd_vel [geometry_msgs/msg/Twist]
~~~
- ここで/turtle1/cmd_velがgeometry_msgsのパッケージの中のTwistというメッセージを配信することを意味する
-  ~~ros2 msg show ＜メッセージ名＞でメッセージのデータ構造を知れる~~
- ros2 interface show ＜message or service or action＞でメッセージなどのデータ構造を知れる
~~~bash
ros2 interface show geometry_msgs/msg/Twist
~~~
~~~txt
vector3 linear
		float64 x
		float64 y
		float64 z
vector3 angler
		float64 x
		float64 y
		float64 z
~~~
- ここでわかるのは/teleop_turtleは/turtlesimに対してlinear（前進）angler（回転）の速度をそれぞれ3次元野ベクトルとして配信しているということ

6. トピックへデータを配信
- turtlesim_nodeを起動、さらに別のターミナル(端末)からros2 topic pub ＜topic name＞ ＜message type＞ '＜配信するデータ＞'のように配信コマンドを実行する
~~~bash
ros2 topic pub --once /turtle1/cmd_vel geometry_msgs/msg/Twist '{linear: {x: 2.0, y: 0.0, z: 0.0}, angular: {x: 0.0, y: 0.0, z: 1.8}}'
~~~
- 円が描ける
- --onceが--rate 1だと1sで1回の割合でコマンドを実行してくれる（勝手に円をかいてくれる）

## サービス

## アクション
- アクションはパブリッシャーサブスクライバー通信とサービス通信と並ぶ通信方式の1つ
1. クライアントがサーバーに処理の目標を送信する
2. サーバが対象の処理を開始し、処理や途中経過をクライアントに送信
3. サーバが対象の処理を完了し、処理結果をクライアントに送信
- 処理の中断が可能

- goal: 走行タスクの目標地点
- result: 走行結果やエラーコード
- feedback: 走行途中のロボットのポーズ

**1つのアクション通信の3つの要素**
- Goal Service: Goalの設定に関わるService通信
- Result Service: Resultの送受信に関わるService通信
- Feedback Topic: Feedbackの送信に関わるPub&Sub通信

[reuturn](ROS2.md)